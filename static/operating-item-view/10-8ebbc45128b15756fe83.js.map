{"version":3,"sources":["webpack:///./src/components-react/UploadImage/v1.0.0/view/index.js","webpack:///./src/components-react/UploadImage/v1.0.0/view/UploadImage.js"],"names":["l","r","__webpack_require__","__esModule","default","t","e","exports","1268","a","1269","Object","defineProperty","value","c","o","s","n","i","d","p","_react","f","u","_message3","config","top","duration","uploadFlag","UploadImg","props","context","_classCallCheck3","this","_this","_possibleConstructorReturn3","__proto__","_getPrototypeOf2","call","beforeUpload","file","maxFileSize","fileSizeType","imgTypes","imgType","isLt2M","isImgTypes","fileName","name","length","fileTypes","split","type","toUpperCase","map","types","index","indexOf","size","parseInt","error","handleChange","info","status","loading","response","code","picture","data","setState","imageUrl","attr","relation","onChange","obj","msg","onRemove","url","state","nextProps","key","style","action","wrapClassName","className","_react2","createElement","class","src","_upload2","showUploadList","bind","onClick","_icon2","Component"],"mappings":"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","file":"10-8ebbc45128b15756fe83.js","sourcesContent":["import UploadImage from './UploadImage';\r\nexport default UploadImage;","/**\r\n * shop 上传图片，携带重新上传和删除按钮\r\n */\r\nimport React, { Component } from 'react';\r\nimport {message,Upload,Icon} from 'jdcloudui';\r\nimport './style/index.css';\r\nmessage.config({\r\n  top: 300,\r\n  duration: 2,\r\n});\r\nlet uploadFlag = true;\r\nfunction getBase64(img, callback,imageUrl) {\r\n  const reader = new FileReader();\r\n  if(imageUrl && imageUrl!=''){\r\n    reader.addEventListener('load', () => callback(imageUrl));\r\n    //reader.readAsDataURL(imageUrl);\r\n  }else{\r\n    reader.addEventListener('load', () => callback(reader.result));\r\n    reader.readAsDataURL(img);\r\n  }\r\n}\r\nexport default class UploadImg extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.state={\r\n      imageUrl: props.imageUrl || ''\r\n    };\r\n  }\r\n  componentWillReceiveProps(nextProps){\r\n    this.setState({\r\n      imageUrl: nextProps.imageUrl || ''\r\n    });\r\n  }\r\n  beforeUpload =(file)=>{\r\n    const maxFileSize = this.props.maxFileSize;\r\n    let fileSizeType = this.props.fileSizeType;\r\n    let imgTypes = this.props.imgType;\r\n    var isLt2M = true,isImgTypes=true;\r\n    var fileName = file.name;\r\n    //var validate= file.type === 'image/jpeg';\r\n    if(imgTypes && imgTypes.length>0){\r\n      var fileTypes=fileName.split('.');\r\n      var type = fileTypes[fileTypes.length-1];\r\n      type = type.toUpperCase();\r\n      imgTypes = imgTypes.map((types,index)=>{\r\n        return types.toUpperCase();\r\n      });\r\n      if(imgTypes.indexOf(type)=== -1){//文件类型不在用户指定的范围内\r\n        isImgTypes =false;\r\n      }\r\n    }\r\n    if(maxFileSize && file.size){\r\n      if(fileSizeType && (fileSizeType.toUpperCase()=='M' ||\r\n        fileSizeType.toUpperCase()=='MB')){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='KB'){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='B'){\r\n        isLt2M = file.size <= parseInt(maxFileSize);\r\n      }else{\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;//默认fileSizeType=='M'\r\n      }\r\n    }\r\n    if(!isImgTypes){\r\n      message.error('上传图片的文件格式有误!');\r\n      return false;\r\n    }\r\n    if (!isLt2M) {\r\n      if(!fileSizeType){\r\n        fileSizeType ='M';\r\n      }\r\n      message.error('上传图片的文件大小必须小于'+maxFileSize+fileSizeType+'!');\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  handleChange = (info) => {\r\n    if(info.file.status === 'uploading'){\r\n      if(uploadFlag){\r\n        message.loading('正在上传中，请稍等....',1);\r\n      }\r\n      uploadFlag = false;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      uploadFlag = true;\r\n      var response=info.file.response;\r\n      if(response && response.code=='0'){\r\n        var picture = response.data;\r\n        this.setState({imageUrl:picture});\r\n        var attr = this.props.relation;\r\n        let {onChange} = this.props;\r\n        var obj={};\r\n        obj[attr]= picture;\r\n        onChange(obj);\r\n        //getBase64(info.file.originFileObj, imageUrl => this.setState({ imageUrl }),picture.pictureURL);\r\n      }else{\r\n        if(response && response.code=='-1'){\r\n          message.error(response.msg)\r\n        }else{\r\n          message.error(\"上传失败！\");\r\n        }\r\n        let {onChange} = this.props;\r\n        var obj={};\r\n        onChange(obj);\r\n      }\r\n    }\r\n    if (info.file.status === 'error') {\r\n      uploadFlag = true;\r\n      message.error(\"上传失败！\")\r\n    }\r\n  }\r\n  \r\n  //移除\r\n  onRemove = ()=>{\r\n    //更新图片\r\n    if(this.props.onRemove && typeof this.props.onRemove=='function'){\r\n      this.props.onRemove({url: this.state.imageUrl});\r\n    }\r\n    this.setState({\r\n      imageUrl: undefined\r\n    });\r\n  }\r\n\r\n  render(){\r\n    //const styles = require('./style/UploadImg.less');\r\n    let style = this.props.style || {};\r\n    const action = this.props.action;\r\n    const data =this.props.data;\r\n    const name = this.props.name;\r\n    let imageUrl = this.state.imageUrl || '';\r\n\r\n    let wrapClassName = 'upload-select-wrap ' + (this.props.className || '');\r\n    if(imageUrl && imageUrl.length>0){\r\n      wrapClassName += ' solid-border';\r\n    }\r\n    return(\r\n      <div className={wrapClassName} style={style}>\r\n        {\r\n          imageUrl && imageUrl!='' ?\r\n          <div class=\"upload-select-box\">\r\n            <img src={imageUrl} />\r\n            <div class=\"upload-select-footer\">\r\n              <Upload\r\n                name={name}\r\n                showUploadList={false}\r\n                action={action}\r\n                beforeUpload={this.beforeUpload.bind(this)}\r\n                onChange={this.handleChange.bind(this)}\r\n                data={data}\r\n              >\r\n                <div class=\"upload-select-btn\">重新上传</div>\r\n              </Upload>\r\n              <div class=\"upload-select-removebtn\" onClick={this.onRemove}>删除</div>\r\n            </div>\r\n          </div>\r\n          :\r\n            <Upload\r\n              name={name}\r\n              showUploadList={false}\r\n              action={action}\r\n              beforeUpload={this.beforeUpload.bind(this)}\r\n              onChange={this.handleChange.bind(this)}\r\n              data={data}\r\n            >\r\n              <div className='upload-select-defaultbtn'>\r\n                <Icon type=\"plus\" className='upload-plus' /> <br/>上传图片\r\n              </div>\r\n            </Upload>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n  \r\n}"],"sourceRoot":""}